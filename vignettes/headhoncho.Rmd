---
title: "Using The headhoncho Package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using The headhoncho Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
cat("\n", getwd(), "\n")
```


```{r, include = FALSE}
options(gargle_oauth_cache = "../.secrets")
if (dir.exists("../.secrets")) {
  googlesheets4::gs4_auth(cache = "../.secrets", email = "*@smith.edu")
  can_authenticate <- TRUE
} else {
  can_authenticate <- FALSE
}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = can_authenticate
)
```

```{r setup}
library(headhoncho)
```


This article is designed give a brief overview of the functionality of the `xkcd()` package. 

## The `read_google_sheet()` function

This function is the `headhoncho` equivalent to the `googlesheets4::read_sheet()` function. By taking in an identifier of a (private, in your Google Drive account) Google Sheet, this function converts the data into a tibble that can be stroed in your environment and manipulated. This is the reccomended first step, although you are able to skip over it if your data of interest is originally stored in a non-Google-Sheet file. 

```{r}
example_data <- read_google_sheet("https://docs.google.com/spreadsheets/d/1HO3e_VCqdbyRGbKOgzt57aLLlhVCP7YQGmy411tqGNc/edit#gid=0")
example_data
#> ✔ Reading from headhoncho package example data.
#> ✔ Range full_data.
#> # A tibble: 599 × 9
#>    Last_Name First_Name Student_Type   Hall            Room Room_Type Citizenship_DESC DOB                 Email            
#>    <chr>     <chr>      <chr>          <chr>          <dbl> <chr>     <chr>            <dttm>              <chr>            
#>  1 Hardy     Rosalinda  Ent First Year Togepi House     508 Quadruple Domestic         1994-06-15 00:00:00 rhardy@pokeacade…
#>  2 Pierce    Christa    Ent First Year Squirtle House   209 Single    Domestic         2001-08-10 00:00:00 cpierce@pokeacad…
#>  3 Patrick   Heriberto  Ent First Year Ho-Oh House      306 Quadruple Domestic         1993-03-06 00:00:00 hpatrick@pokeaca…
#>  4 Mason     Stefan     Ent First Year Umbreon House    212 Triple    Domestic         1994-06-09 00:00:00 smason@pokeacade…
#>  5 Booth     Mike       Ent First Year Gengar House     302 Triple    Domestic         2003-10-30 00:00:00 mbooth@pokeacade…
#>  6 Mitchell  Janice     Ent First Year Bayleef House    212 Single    Domestic         2006-11-20 00:00:00 jmitchell@pokeac…
#>  7 Boone     Quinten    Ent First Year Moltres House    405 Single    Domestic         2004-11-17 00:00:00 qboone@pokeacade…
#>  8 Ibarra    Lillie     Ent Transfer   Ditto House      103 Triple    International    2000-03-23 00:00:00 libarra@pokeacad…
#>  9 Maxwell   Elyssa     Ent First Year Gengar House     310 Single    Domestic         2004-03-10 00:00:00 emaxwell@pokeaca…
#> 10 Silva     Elizabeth  Ent First Year Ivysaur House    407 Triple    Domestic         2005-04-20 00:00:00 esilva@pokeacade…
#> # ℹ 589 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


## The `split_sheet()` function

This function is the main functionality of the package. It takes in a dataframe object (typically a tibble that has been `read_google_sheet()`) as well as the columns on which to group and split. It outputs a list of dataframes, where each dataframe contains a single group of the splitting variables. Columns should be specified using the `data_frame$variable` format, and as many columns as desired can be specified as individual arguments (no need to group them manually into any sort of list to pass to the function!). After creating the list of dataframes, this function automatically discards any dataframes for which there are 0 observations, but this behavior can be overridden by specifying `keep = TRUE`. For example, here is a dataframe in which observations will be discarded:

```{r}
df <- data.frame (A = c("a", "a", "b", "b"),
                  B = c(1, 2, 2, 3),
                  C = c(TRUE, TRUE, TRUE, FALSE))

## Don't keep data frames with no observations (ex: group formed by df$A == "a" and df$B == 3)
data_list <- split_sheet(df, df$A, df$B)
data_list

## Keep all data frames regardless of if they are empty.
data_list_2 <- split_sheet(df, df$A, df$B, keep = TRUE)
data_list_2
```

Here is the `split_sheet()` function when used on the headhoncho mock dataset:

```{r}
example_data_list <- split_sheet(example_data, example_data$Citizenship_DESC)
example_data_list
#> $Domestic
#> # A tibble: 451 × 9
#>    Last_Name First_Name Student_Type   Hall            Room Room_Type Citizenship_DESC DOB                 Email           
#>    <chr>     <chr>      <chr>          <chr>          <dbl> <chr>     <chr>            <dttm>              <chr>           
#>  1 Hardy     Rosalinda  Ent First Year Togepi House     508 Quadruple Domestic         1994-06-15 00:00:00 rhardy@pokeacad…
#>  2 Pierce    Christa    Ent First Year Squirtle House   209 Single    Domestic         2001-08-10 00:00:00 cpierce@pokeaca…
#>  3 Patrick   Heriberto  Ent First Year Ho-Oh House      306 Quadruple Domestic         1993-03-06 00:00:00 hpatrick@pokeac…
#>  4 Mason     Stefan     Ent First Year Umbreon House    212 Triple    Domestic         1994-06-09 00:00:00 smason@pokeacad…
#>  5 Booth     Mike       Ent First Year Gengar House     302 Triple    Domestic         2003-10-30 00:00:00 mbooth@pokeacad…
#>  6 Mitchell  Janice     Ent First Year Bayleef House    212 Single    Domestic         2006-11-20 00:00:00 jmitchell@pokea…
#>  7 Boone     Quinten    Ent First Year Moltres House    405 Single    Domestic         2004-11-17 00:00:00 qboone@pokeacad…
#>  8 Maxwell   Elyssa     Ent First Year Gengar House     310 Single    Domestic         2004-03-10 00:00:00 emaxwell@pokeac…
#>  9 Silva     Elizabeth  Ent First Year Ivysaur House    407 Triple    Domestic         2005-04-20 00:00:00 esilva@pokeacad…
#> 10 Harris    Justin     Ent First Year Caterpie House   411 Single    Domestic         1991-11-22 00:00:00 jharris@pokeaca…
#> # ℹ 441 more rows
#> # ℹ Use `print(n = ...)` to see more rows
#> 
#> $International
#> # A tibble: 148 × 9
#>    Last_Name First_Name Student_Type   Hall            Room Room_Type Citizenship_DESC DOB                 Email           
#>    <chr>     <chr>      <chr>          <chr>          <dbl> <chr>     <chr>            <dttm>              <chr>           
#>  1 Ibarra    Lillie     Ent Transfer   Ditto House      103 Triple    International    2000-03-23 00:00:00 libarra@pokeaca…
#>  2 Gallegos  Ernest     Ent Transfer   Torterra House   212 Triple    International    2006-11-03 00:00:00 egallegos@pokea…
#>  3 Krause    Daisy      Ent Transfer   Zapdos House     308 Single    International    1992-06-25 00:00:00 dkrause@pokeaca…
#>  4 Gates     Kiersten   Ent Transfer   Pidgey House     413 Quadruple International    1993-11-23 00:00:00 kgates@pokeacad…
#>  5 Barrera   Kristin    Ent First Year Zapdos House     311 Triple    International    1997-08-14 00:00:00 kbarrera@pokeac…
#>  6 Pollard   Candice    Ent First Year Togepi House     508 Triple    International    2001-06-27 00:00:00 cpollard@pokeac…
#>  7 Luna      Fabian     Ent First Year Caterpie House   502 Single    International    1991-09-11 00:00:00 fluna@pokeacade…
#>  8 Marshall  Erik       Ent First Year Caterpie House   306 Quadruple International    2003-03-11 00:00:00 emarshall@pokea…
#>  9 Lester    Hayden     Ent Transfer   Wailord House    304 Single    International    2005-12-21 00:00:00 hlester@pokeaca…
#> 10 Liu       Brianna    Ent First Year Wailord House    310 Single    International    1994-09-26 00:00:00 bliu@pokeacadem…
#> # ℹ 138 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


## The `export_data()` function

The `export_data()` function does the opposite of the `read_sheet()` function: it takes a (list of) dataframe(s) in your R environment and exports them to separate Google Sheets. This function will default to creating new Google Sheets to be written, but can take a vector of sheet identifiers if there are specific sheets that you would like to overwrite. 




